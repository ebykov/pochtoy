import { h, Component } from 'preact';
import { connect } from 'preact-redux';
import Enter from './enter';
import Question from './question';
import Result from './result';

class App extends Component {
  constructor() {
    super();

    this.onImageLoad = this.onImageLoad.bind(this);
    this.onImageAnimationEnd = this.onImageAnimationEnd.bind(this);
  }

  onImageLoad() {
    this.setState({
      isImageLoaded: true,
    });
  }

  onImageAnimationEnd() {
    this.setState({
      isImageAnimationEnd: true,
    });
  }

  render(props, state) {
    const getEnter = () => {
      if (window.innerWidth < 640) {
        return <Enter />;
      } else {
        return [
          window.innerWidth >= 1025 ? <img style={ state.isImageLoaded ? { animation: 'hands 1.5s' } : {} } src="https://leonardo.osnova.io/e6c7d2d4-ebec-e945-761b-6bcf295ad3da/" alt="" class="pochtoy-hands pochtoy-hands--l" /> : null,
          <img style={ state.isImageLoaded ? { animation: 'hands 1.5s' } : {} } onLoad={this.onImageLoad} onAnimationEnd={this.onImageAnimationEnd} src="https://leonardo.osnova.io/e6c7d2d4-ebec-e945-761b-6bcf295ad3da/" alt="" class="pochtoy-hands pochtoy-hands--r" />,
          state.isImageAnimationEnd ? <Enter /> : null
        ]
      }
    };

    const getBody = (status) => {
      switch (status) {
        case 'START': return <Question />;
        case 'RESULT': return <Result />;
        default: return getEnter();
      }
    };

    const mainClassName = (() => {
      let className = 'pochtoy';
      if (props.test.params.isFeed) {
        className += ' is-feed';
      }
      if (props.test.status === 'RESULT') {
        className += ' is-result';
      }
      return className;
    })();

    return (
      <div className={mainClassName}>
        <a href="http://pochtoy.com/black-friday-2018/?utm_source=tjournal&utm_medium=test&utm_campaign=black-friday-2018" target="_blank" className="pochtoy__logo">
          <svg viewBox="0 0 1945.95 667">
            <path d="M320 667l37-20V325l-37 20v322zM395 621l37-20V279l-37 20v322zM476 579l37-20V237l-37 20v322zM553 532l37-20V190l-37 20v322zM530 116L249 277l34 20 278-163-31-18zM218 258L496 95l-31-18-281 161 34 20zM148 220L426 57l-31-18-281 161 34 20zM358 18L327 0 46 161l34 20L358 18zM0 195v42l282 162-1-42L0 195zM0 283v42l282 162-1-42L0 283zM0 375v42l282 162-1-42L0 375zM0 461v42l282 162-1-42L0 461zM748.26 277.92c-6.9-3.18-15.16-4.51-24.59-4.51H678v106h24v-29h21.67a59.89 59.89 0 0 0 24.55-4.8 36.15 36.15 0 0 0 16-13.55 37 37 0 0 0 5.62-20.44q0-11.86-5.62-20.52c-3.71-5.78-9.06-10-15.96-13.18zm-9.08 47.49c-3.85 3.19-9.48 5-16.87 5H702v-37h20.3c7.4 0 13 1.43 16.87 4.62s5.83 7.79 5.83 13.77-2 10.43-5.82 13.61zM872 278.33a65.85 65.85 0 0 0-59.66 0 53 53 0 0 0-20.8 19.67 56.6 56.6 0 0 0 0 56.39 53 53 0 0 0 20.82 19.69 65.85 65.85 0 0 0 59.66 0 54.27 54.27 0 0 0-.02-95.75zm-.89 65.51a31.09 31.09 0 0 1-11.93 12.08 35.62 35.62 0 0 1-34 0 31.08 31.08 0 0 1-11.93-12.08 38 38 0 0 1 0-35.26 31.08 31.08 0 0 1 11.95-12.08 35.62 35.62 0 0 1 34 0 31.09 31.09 0 0 1 11.93 12.08 38 38 0 0 1 0 35.26zM955.47 296.51a35.52 35.52 0 0 1 17.63-4.33q16 0 26.75 12.46l15.81-14.64a50.11 50.11 0 0 0-18.77-14 66 66 0 0 0-54.57 2.2 52.74 52.74 0 0 0-20.67 19.61 57.17 57.17 0 0 0 0 56.7 52.74 52.74 0 0 0 20.67 19.61 61.11 61.11 0 0 0 29.41 7.06 62.57 62.57 0 0 0 25.08-4.86 49.28 49.28 0 0 0 18.85-14.14l-15.81-14.59q-10.79 12.62-26.75 12.62a35.51 35.51 0 0 1-17.63-4.33 30.79 30.79 0 0 1-12.08-12.08 38 38 0 0 1 0-35.26 30.79 30.79 0 0 1 12.08-12.03zM1107 315.41h-48v-42h-25v106h25v-44h48v44h25v-106h-25v42zM1194.42 271.19a103.45 103.45 0 0 0-26.3 3.34 91 91 0 0 0-23.71 9.88l8.23 18.39a85.49 85.49 0 0 1 29.36-10.18v86.79h25v-86.79a84.34 84.34 0 0 1 29.27 10.18l8.33-18.39a88.51 88.51 0 0 0-23.65-9.88 105 105 0 0 0-26.53-3.34zM1337.29 278.33a65.85 65.85 0 0 0-59.66 0 53 53 0 0 0-20.82 19.67 56.59 56.59 0 0 0 0 56.39 53 53 0 0 0 20.82 19.69 65.84 65.84 0 0 0 59.66 0 54.27 54.27 0 0 0 0-95.75zm-.89 65.51a31.09 31.09 0 0 1-11.93 12.08 35.62 35.62 0 0 1-34 0 31.07 31.07 0 0 1-11.93-12.08 38 38 0 0 1 0-35.26 31.07 31.07 0 0 1 11.93-12.08 35.62 35.62 0 0 1 34 0 31.09 31.09 0 0 1 11.93 12.08 38 38 0 0 1 0 35.26zM1456 306.15c0 9-2.38 15.76-6.84 20.22s-10.56 6.69-18.16 6.69c-7.2 0-12.94-2.13-16.9-6.38s-6.1-10.54-6.1-18.85v-34.42h-24v35.93c0 14.39 3.45 25.41 10.69 33.06s17.67 11.48 31.15 11.48c13 0 23.16-4.36 30.16-13.07v6.54c0 9.42-2.3 16.39-6.61 20.9s-11 6.76-19.91 6.76a52.08 52.08 0 0 1-33.78-11.7l-9.59 18.24a55.49 55.49 0 0 0 19.14 10.56 78.45 78.45 0 0 0 24.77 3.72c15.71 0 27.85-4.28 36.77-12.84s13.21-20.86 13.21-36.87v-72.71h-24v32.74zM1502.19 355.17a13.88 13.88 0 0 0-4.26 10.56 14.43 14.43 0 0 0 4.26 10.64 15 15 0 0 0 21 0 14.44 14.44 0 0 0 4.26-10.64 13.89 13.89 0 0 0-4.26-10.56 15.67 15.67 0 0 0-21 0zM1578.67 296.49a35.52 35.52 0 0 1 17.63-4.33q16 0 26.75 12.46l15.81-14.62a50.11 50.11 0 0 0-18.77-14 66 66 0 0 0-54.57 2.2 52.74 52.74 0 0 0-20.67 19.61 57.16 57.16 0 0 0 0 56.7 52.74 52.74 0 0 0 20.67 19.61 61.11 61.11 0 0 0 29.41 7.07 62.57 62.57 0 0 0 25.07-4.81 49.28 49.28 0 0 0 18.85-14.14L1623 347.68q-10.79 12.62-26.75 12.62a35.51 35.51 0 0 1-17.63-4.33 30.79 30.79 0 0 1-12.08-12.08 38 38 0 0 1 0-35.26 30.79 30.79 0 0 1 12.13-12.14zM1736.29 278.33a65.85 65.85 0 0 0-59.66 0 53 53 0 0 0-20.82 19.67 56.59 56.59 0 0 0 0 56.39 53 53 0 0 0 20.82 19.68 65.84 65.84 0 0 0 59.66 0 54.53 54.53 0 0 0 0-95.74zm-.84 65.51a31.09 31.09 0 0 1-11.93 12.08 35.62 35.62 0 0 1-34 0 31.07 31.07 0 0 1-11.93-12.08 38 38 0 0 1 0-35.26 31.07 31.07 0 0 1 11.93-12.08 35.62 35.62 0 0 1 34 0 31.09 31.09 0 0 1 11.93 12.08 38 38 0 0 1 0 35.26zM1935.64 282.21c-7-7.34-16.68-11-29.25-11a47.73 47.73 0 0 0-19.94 4 35.22 35.22 0 0 0-14.34 11.63 28.93 28.93 0 0 0-12.61-11.63 43 43 0 0 0-19.15-4 42.14 42.14 0 0 0-18.51 3.88 30.57 30.57 0 0 0-12.89 11v-12.68h-24v106h25v-63.08c0-8.11 1.93-14.16 6.08-18.16s9.6-6 16.49-6c6.28 0 11.27 1.9 14.92 5.7s5.5 9.45 5.5 17v64.59H1877v-63.13c0-8.11 2.32-14.16 6.48-18.16s9.85-6 16.84-6c6.38 0 11.72 1.9 15.63 5.7s6 9.45 6 17v64.59h24V314c0-13.83-3.32-24.45-10.31-31.79z"/>
          </svg>
        </a>
        <div className={`pochtoy__inner${props.test.status === 'RESULT' ? ' pochtoy__inner--result' : ''}`}>
          {getBody(props.test.status)}
        </div>
      </div>
    );
  }
}

const mapStateToProps = function(store) {
  return {
    test: store.testState
  };
};

export default connect(mapStateToProps)(App);